---
import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import {
  ExternalLink,
  GitBranch,
  ArrowLeft,
  Calendar,
  User,
} from 'lucide-react';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { Content } = await project.render();

// Get related projects (same technologies)
const allProjects = await getCollection('projects');
const relatedProjects = allProjects
  .filter((p) => p.slug !== project.slug)
  .filter((p) => p.data.tech.some((tech) => project.data.tech.includes(tech)))
  .slice(0, 3);
---

<Layout
  title={`${project.data.title} - Projects`}
  description={project.data.description}
  image={project.data.image}
  type='article'
>
  <!-- Back Navigation -->
  <div class='container mx-auto px-4 pt-8 sm:px-6 lg:px-8'>
    <a
      href='/projects'
      class='group inline-flex items-center space-x-2 text-primary-600 transition-colors hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300'
    >
      <ArrowLeft
        className='h-4 w-4 transition-transform group-hover:-translate-x-1'
      />
      <span>Back to Projects</span>
    </a>
  </div>

  <!-- Project Header -->
  <section class='bg-white py-12 dark:bg-gray-900'>
    <div class='container mx-auto px-4 sm:px-6 lg:px-8'>
      <div class='mx-auto max-w-4xl'>
        <!-- Project Image -->
        <div
          class='mb-8 aspect-video overflow-hidden rounded-2xl bg-gradient-to-br from-primary-100 to-purple-100 dark:from-primary-900 dark:to-purple-900'
        >
          <img
            src={project.data.image}
            alt={project.data.title}
            class='h-full w-full object-cover'
          />
        </div>

        <!-- Project Info -->
        <div class='flex flex-col lg:flex-row lg:items-start lg:space-x-12'>
          <div class='mb-8 flex-1 lg:mb-0'>
            <h1
              class='mb-4 text-3xl font-bold text-gray-900 dark:text-white md:text-5xl'
            >
              {project.data.title}
            </h1>

            <p class='mb-6 text-xl text-gray-600 dark:text-gray-300'>
              {project.data.description}
            </p>

            <!-- Technologies -->
            <div class='mb-8'>
              <h3
                class='mb-3 text-sm font-semibold uppercase tracking-wide text-gray-900 dark:text-white'
              >
                Technologies Used
              </h3>
              <div class='flex flex-wrap gap-2'>
                {
                  project.data.tech.map((tech) => (
                    <span class='rounded-full bg-primary-100 px-3 py-1 text-sm font-medium text-primary-700 dark:bg-primary-900 dark:text-primary-300'>
                      {tech}
                    </span>
                  ))
                }
              </div>
            </div>

            <!-- Project Links -->
            <div class='flex flex-col gap-4 sm:flex-row'>
              {
                project.data.demo && (
                  <a
                    href={project.data.demo}
                    target='_blank'
                    rel='noopener noreferrer'
                    class='btn-primary inline-flex items-center justify-center space-x-2'
                  >
                    <ExternalLink className='w-5 h-5' />
                    <span>View Live Demo</span>
                  </a>
                )
              }
              {
                project.data.github && (
                  <a
                    href={project.data.github}
                    target='_blank'
                    rel='noopener noreferrer'
                    class='btn-secondary inline-flex items-center justify-center space-x-2'
                  >
                    <GitBranch className='w-5 h-5' />
                    <span>View Source Code</span>
                  </a>
                )
              }
            </div>
          </div>

          <!-- Project Stats/Info -->
          <div class='w-full space-y-6 lg:w-80'>
            <div class='card'>
              <h3 class='mb-4 font-semibold text-gray-900 dark:text-white'>
                Project Details
              </h3>
              <div class='space-y-3 text-sm'>
                <div class='flex items-center space-x-2'>
                  <Calendar
                    className='h-4 w-4 text-gray-500 dark:text-gray-400'
                  />
                  <span class='text-gray-600 dark:text-gray-300'>Status:</span>
                  <span class='font-medium text-green-600 dark:text-green-400'
                    >Active</span
                  >
                </div>
                <div class='flex items-center space-x-2'>
                  <User className='h-4 w-4 text-gray-500 dark:text-gray-400' />
                  <span class='text-gray-600 dark:text-gray-300'>Type:</span>
                  <span class='font-medium text-gray-900 dark:text-white'
                    >Web Application</span
                  >
                </div>
              </div>
            </div>

            {
              project.data.featured && (
                <div class='rounded-xl bg-gradient-to-r from-primary-500 to-purple-600 p-4 text-white'>
                  <div class='mb-2 flex items-center space-x-2'>
                    <svg
                      class='h-5 w-5'
                      fill='currentColor'
                      viewBox='0 0 20 20'
                    >
                      <path d='M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z' />
                    </svg>
                    <span class='font-semibold'>Featured Project</span>
                  </div>
                  <p class='text-sm opacity-90'>
                    This project showcases advanced techniques and best
                    practices.
                  </p>
                </div>
              )
            }
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Project Content -->
  <section class='bg-gray-50 py-12 dark:bg-gray-800'>
    <div class='container mx-auto px-4 sm:px-6 lg:px-8'>
      <div class='mx-auto max-w-4xl'>
        <div class='prose-custom'>
          <Content />
        </div>
      </div>
    </div>
  </section>

  <!-- Related Projects -->
  {
    relatedProjects.length > 0 && (
      <section class='bg-white py-20 dark:bg-gray-900'>
        <div class='container mx-auto px-4 sm:px-6 lg:px-8'>
          <div class='mx-auto max-w-6xl'>
            <h2 class='mb-12 text-center text-3xl font-bold text-gray-900 dark:text-white'>
              Related Projects
            </h2>

            <div class='grid grid-cols-1 gap-8 md:grid-cols-3'>
              {relatedProjects.map((relatedProject) => (
                <article class='card group transition-all duration-300 hover:shadow-xl'>
                  <div class='mb-4 aspect-video overflow-hidden rounded-lg bg-gradient-to-br from-primary-100 to-purple-100 dark:from-primary-900 dark:to-purple-900'>
                    <img
                      src={relatedProject.data.image}
                      alt={relatedProject.data.title}
                      class='h-full w-full object-cover transition-transform duration-300 group-hover:scale-105'
                      loading='lazy'
                    />
                  </div>
                  <h3 class='mb-2 text-lg font-semibold text-gray-900 transition-colors group-hover:text-primary-600 dark:text-white dark:group-hover:text-primary-400'>`
                    <a href={`/projects/${relatedProject.slug}`}>
                      {relatedProject.data.title}
                    </a>
                  </h3>
                  <p class='mb-4 text-sm text-gray-600 dark:text-gray-300'>
                    {relatedProject.data.description}
                  </p>
                  <div class='flex flex-wrap gap-1'>
                    {relatedProject.data.tech.slice(0, 3).map((tech) => (
                      <span class='rounded bg-gray-100 px-2 py-1 text-xs text-gray-700 dark:bg-gray-700 dark:text-gray-300'>
                        {tech}
                      </span>
                    ))}
                  </div>
                </article>
              ))}
            </div>
          </div>
        </div>
      </section>
    )
  }

  <!-- Call to Action -->
  <section class='bg-primary-600 py-20 text-white'>
    <div class='container mx-auto px-4 text-center sm:px-6 lg:px-8'>
      <h2 class='mb-6 text-3xl font-bold'>Interested in Similar Work?</h2>
      <p class='mb-8 text-xl opacity-90'>
        Let's discuss how we can create something amazing together
      </p>
      <div class='flex flex-col justify-center gap-4 sm:flex-row'>
        <a
          href='/contact'
          class='rounded-lg bg-white px-8 py-4 font-semibold text-primary-600 transition-colors hover:bg-gray-100'
        >
          Start a Project
        </a>
        <a
          href='/projects'
          class='rounded-lg border-2 border-white px-8 py-4 font-semibold text-white transition-all hover:bg-white hover:text-primary-600'
        >
          View More Projects
        </a>
      </div>
    </div>
  </section>
</Layout>
`