---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import MediaSection from '../components/MediaSection.astro';
import Section from '../components/ui/Section.astro';
import Typography from '../components/ui/Typography.astro';
import Button from '../components/ui/Button.astro';
import Card from '../components/ui/Card.astro';
import SocialProofCounter from '../components/ui/SocialProofCounter.astro';
import FloatingActionButton from '../components/ui/FloatingActionButton.astro';
import ErrorBoundary from '../components/ui/ErrorBoundary.astro';
import EnhancedContactForm from '../components/ui/EnhancedContactForm.astro';
---

<Layout title="ProBuild Construction - Professional Construction & HVAC Services" description="Leading construction and HVAC contractor serving residential and commercial clients. Licensed, insured, and trusted for quality craftsmanship.">
  <Navigation />
  
  <!-- Hero Section -->
  <Section id="home" background="gradient" padding="xl" class="min-h-screen flex items-center relative overflow-hidden">
    <!-- Background Pattern Overlay -->
    <div class="absolute inset-0 opacity-10">
      <svg width="100" height="100" viewBox="0 0 100 100" class="w-full h-full">
        <defs>
          <pattern id="hero-dots" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <circle cx="10" cy="10" r="2" fill="currentColor" opacity="0.3"/>
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#hero-dots)"/>
      </svg>
    </div>
    
    <div class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <!-- Hero Content -->
      <div class="space-y-8 text-center lg:text-left" data-animate>
        <!-- Badge -->
        <div class="inline-flex items-center bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full">
          <i class="fas fa-star text-yellow-400 mr-2"></i>
          <span class="text-sm font-medium text-white">Rated #1 Construction Service</span>
        </div>
        
        <!-- Main Heading -->
        <Typography variant="h1" color="white" class="font-black">
          Build Your
          <span class="block text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 animate-pulse-soft">
            Dream Space
          </span>
        </Typography>
        
        <!-- Subtitle -->
        <Typography variant="subtitle" color="white" class="max-w-2xl mx-auto lg:mx-0">
          Professional construction, HVAC, and home improvement services. 
          <span class="font-semibold">Licensed, insured, and trusted</span> by hundreds of satisfied customers.
        </Typography>
        
        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
          <Button variant="secondary" size="lg" glow={true} class="group">
            <i class="fas fa-phone mr-2 group-hover:animate-bounce"></i>
            Get Free Quote
          </Button>
          <Button variant="outline" size="lg" class="text-white border-white hover:bg-white hover:text-brand-primary-600">
            <i class="fas fa-play mr-2"></i>
            Watch Our Work
          </Button>
        </div>
        
        <!-- Trust Indicators -->
        <div class="grid grid-cols-3 gap-6 pt-8">
          <div class="text-center">
            <Typography variant="h3" color="white" class="font-bold">25+</Typography>
            <Typography variant="caption" color="white" class="opacity-80">Years Experience</Typography>
          </div>
          <div class="text-center">
            <Typography variant="h3" color="white" class="font-bold">500+</Typography>
            <Typography variant="caption" color="white" class="opacity-80">Happy Clients</Typography>
          </div>
          <div class="text-center">
            <Typography variant="h3" color="white" class="font-bold">100%</Typography>
            <Typography variant="caption" color="white" class="opacity-80">Satisfaction</Typography>
          </div>
        </div>
      </div>
      
      <!-- Hero Visual -->
      <div class="relative" data-animate>
        <div class="relative z-10 bg-white/10 backdrop-blur-sm rounded-3xl p-8 shadow-2xl">
          <img 
            src="/api/placeholder/600/400" 
            alt="Professional Construction Work" 
            class="w-full h-auto rounded-2xl shadow-lg"
            loading="eager"
          />
          <!-- Floating Stats -->
          <div class="absolute -top-4 -right-4 bg-white rounded-2xl p-4 shadow-xl animate-float">
            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Licensed & Insured</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Social Proof Section -->
  <Section background="white" padding="lg">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
      <SocialProofCounter 
        value={25} 
        label="Years Experience" 
        suffix="+" 
        icon="fas fa-calendar-check"
        variant="outlined"
        animate={true}
      />
      <SocialProofCounter 
        value={500} 
        label="Projects Completed" 
        suffix="+" 
        icon="fas fa-hammer"
        variant="filled"
        animate={true}
        delay={200}
      />
      <SocialProofCounter 
        value={100} 
        label="Satisfaction Rate" 
        suffix="%" 
        icon="fas fa-thumbs-up"
        variant="gradient"
        animate={true}
        delay={400}
      />
      <SocialProofCounter 
        value={24} 
        label="Hour Support" 
        suffix="/7" 
        icon="fas fa-phone-volume"
        variant="outlined"
        animate={true}
        delay={600}
      />
    </div>
  </Section>

  <!-- About Section -->
  <Section id="about" background="light" padding="xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <div class="space-y-6">
        <Typography variant="overline" color="primary" class="tracking-wider">About ProBuild</Typography>
        <Typography variant="h2" color="neutral">
          Building Excellence Since 1998
        </Typography>
        <Typography variant="body" color="muted" class="text-lg leading-relaxed">
          With over 25 years of experience in the construction industry, ProBuild Construction has established itself as the premier choice for residential and commercial projects. Our team of skilled professionals combines traditional craftsmanship with modern techniques to deliver exceptional results.
        </Typography>
        
        <!-- Feature List -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {[
            { icon: "fas fa-shield-alt", text: "Fully Licensed & Insured" },
            { icon: "fas fa-award", text: "Award-Winning Service" },
            { icon: "fas fa-clock", text: "On-Time Completion" },
            { icon: "fas fa-dollar-sign", text: "Competitive Pricing" }
          ].map((feature) => (
            <div class="flex items-center space-x-3">
              <div class="flex-shrink-0 w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                <i class={`${feature.icon} text-blue-600 dark:text-blue-400 text-sm`}></i>
              </div>
              <Typography variant="body" color="neutral" class="font-medium">
                {feature.text}
              </Typography>
            </div>
          ))}
        </div>
        
        <div class="pt-4">
          <Button variant="primary" size="lg">
            <i class="fas fa-info-circle mr-2"></i>
            Learn More About Us
          </Button>
        </div>
      </div>
      
      <div class="relative">
        <Card variant="elevated" class="p-0 overflow-hidden">
          <img 
            src="/api/placeholder/600/400" 
            alt="Our Professional Team" 
            class="w-full h-auto"
          />
          <div class="p-6">
            <Typography variant="h4" color="neutral" class="mb-2">Meet Our Expert Team</Typography>
            <Typography variant="body" color="muted">
              Dedicated professionals committed to excellence in every project.
            </Typography>
          </div>
        </Card>
      </div>
    </div>
  </Section>

  <!-- Services Section -->
  <Section id="services" background="white" padding="xl">
    <div class="text-center mb-16">
      <Typography variant="overline" color="primary" class="tracking-wider mb-4">Our Services</Typography>
      <Typography variant="h2" color="neutral" class="mb-6">
        Complete Construction Solutions
      </Typography>
      <Typography variant="body" color="muted" class="text-lg max-w-3xl mx-auto">
        From residential renovations to commercial construction, we offer comprehensive services to meet all your building needs.
      </Typography>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {[
        {
          icon: "fas fa-home",
          title: "Residential Construction",
          description: "Custom homes, additions, and renovations built with precision and care.",
          features: ["Custom Design", "Quality Materials", "Licensed Contractors"]
        },
        {
          icon: "fas fa-building",
          title: "Commercial Construction",
          description: "Professional commercial spaces designed for business success.",
          features: ["Project Management", "Timeline Delivery", "Budget Control"]
        },
        {
          icon: "fas fa-snowflake",
          title: "HVAC Systems",
          description: "Complete heating, ventilation, and air conditioning services.",
          features: ["Installation", "Maintenance", "Emergency Repairs"]
        },
        {
          icon: "fas fa-tools",
          title: "Home Renovation",
          description: "Transform your existing space with our renovation expertise.",
          features: ["Kitchen Remodels", "Bathroom Updates", "Full Renovations"]
        },
        {
          icon: "fas fa-bolt",
          title: "Electrical Services",
          description: "Safe and reliable electrical work for homes and businesses.",
          features: ["Wiring Installation", "Panel Upgrades", "Code Compliance"]
        },
        {
          icon: "fas fa-wrench",
          title: "Plumbing Services",
          description: "Complete plumbing solutions from repairs to new installations.",
          features: ["Pipe Installation", "Fixture Replacement", "Leak Repairs"]
        }
      ].map((service) => (
        <Card variant="elevated" hoverable={true} class="h-full group cursor-pointer transform hover:scale-105 transition-all duration-300">
          <div class="text-center p-6 h-full flex flex-col">
            <div class="w-16 h-16 bg-brand-primary-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-brand-primary-600 transition-colors duration-300">
              <i class={`${service.icon} text-2xl text-brand-primary-600 group-hover:text-white transition-colors duration-300`}></i>
            </div>
            <Typography variant="h4" color="neutral" class="mb-3">{service.title}</Typography>
            <Typography variant="body" color="muted" class="mb-4 flex-grow">{service.description}</Typography>
            
            <div class="space-y-2">
              {service.features.map((feature) => (
                <div class="flex items-center justify-center text-sm text-brand-neutral-600">
                  <i class="fas fa-check text-green-500 mr-2"></i>
                  {feature}
                </div>
              ))}
            </div>
            
            <div class="mt-6">
              <Button variant="outline" size="sm" class="w-full group-hover:bg-brand-primary-600 group-hover:text-white group-hover:border-brand-primary-600">
                Learn More
              </Button>
            </div>
          </div>
        </Card>
      ))}
    </div>
  </Section>

  <!-- Media Section (Existing) -->
  <MediaSection />

  <!-- Contact Section -->
  <Section id="contact" background="dark" padding="xl">
    <div class="text-center mb-16">
      <Typography variant="overline" color="white" class="tracking-wider mb-4 opacity-80">Get In Touch</Typography>
      <Typography variant="h2" color="white" class="mb-6">
        Ready to Start Your Project?
      </Typography>
      <Typography variant="body" color="white" class="text-lg max-w-3xl mx-auto opacity-90">
        Contact us today for a free consultation and quote. We're here to help bring your construction dreams to reality.
      </Typography>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <!-- Contact Info -->
      <div class="space-y-8">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          {[
            { icon: "fas fa-phone", title: "Call Us", info: "(555) 123-4567", link: "tel:+15551234567" },
            { icon: "fas fa-envelope", title: "Email Us", info: "info@probuild.com", link: "mailto:info@probuild.com" },
            { icon: "fas fa-map-marker-alt", title: "Visit Us", info: "123 Main St, City", link: "#" },
            { icon: "fas fa-clock", title: "Hours", info: "Mon-Fri 8AM-6PM", link: "#" }
          ].map((contact) => (
            <Card variant="glass" class="p-6 text-center hover:bg-white/20 transition-colors duration-300">
              <div class="w-12 h-12 bg-brand-secondary-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class={`${contact.icon} text-white`}></i>
              </div>
              <Typography variant="h6" color="white" class="mb-2">{contact.title}</Typography>
              {contact.link.startsWith('#') ? (
                <Typography variant="body" color="white" class="opacity-90">{contact.info}</Typography>
              ) : (
                <a href={contact.link} class="text-brand-secondary-300 hover:text-brand-secondary-200 transition-colors duration-200">
                  {contact.info}
                </a>
              )}
            </Card>
          ))}
        </div>
        
        <!-- Google Maps Placeholder -->
        <Card variant="elevated" class="h-64 overflow-hidden">
          <div id="map" class="w-full h-full bg-brand-neutral-200 flex items-center justify-center">
            <div class="text-center">
              <i class="fas fa-map-marked-alt text-4xl text-brand-neutral-400 mb-4"></i>
              <Typography variant="body" color="muted">Interactive Map Loading...</Typography>
            </div>
          </div>
        </Card>
      </div>
      
      <!-- Contact Form -->
      <ErrorBoundary fallbackMessage="Contact form temporarily unavailable. Please call us directly.">
        <Card variant="elevated" class="p-8">
          <EnhancedContactForm 
            showDebugInfo={import.meta.env.DEV}
            action="#"
            method="POST"
            class="enhanced-contact-integration"
          />
        </Card>
      </ErrorBoundary>
    </div>
  </Section>

  <!-- Floating Action Button -->
  <FloatingActionButton 
    icon="fas fa-phone" 
    variant="primary" 
    position="bottom-right"
    tooltip="Call Now for Free Quote"
    onClick="window.open('tel:+15551234567', '_self')"
    animate={true}
  />
</Layout>

<script is:inline>
  // Enhanced script with bulletproof error handling
  document.addEventListener('DOMContentLoaded', async function() {
    try {
      console.log('ProBuild Construction website loading...');
      
      // Initialize error manager if available
      if (window.errorManager) {
        console.log('Error manager already initialized');
      } else {
        console.log('Error manager will be initialized by Layout');
      }

      // Test critical website components
      await testWebsiteComponents();
      
      console.log('ProBuild Construction website loaded successfully');
    } catch (error) {
      console.error('Website initialization failed:', error);
      
      if (window.errorManager) {
        window.errorManager.logError(error, 'WebsiteInit', { showToast: true });
      }
    }
  });

  async function testWebsiteComponents() {
    const tests = [
      { name: 'Navigation', selector: 'nav' },
      { name: 'Hero Section', selector: '#home' },
      { name: 'Services Section', selector: '#services' },
      { name: 'Contact Section', selector: '#contact' },
      { name: 'Enhanced Contact Form', selector: '.enhanced-contact-form' }
    ];

    for (const test of tests) {
      try {
        await new Promise(resolve => setTimeout(resolve, 100)); // Allow DOM to settle
        const element = document.querySelector(test.selector);
        if (!element) {
          throw new Error(`${test.name} not found (${test.selector})`);
        }
        console.log(`✓ ${test.name} loaded successfully`);
      } catch (error) {
        console.warn(`⚠ ${test.name} test failed:`, error.message);
        
        if (window.errorManager) {
          window.errorManager.logError(error, 'ComponentTest', {
            metadata: { component: test.name, selector: test.selector }
          });
        }
      }
    }
  }

  // Enhanced global error handlers
  window.addEventListener('error', (event) => {
    console.error('Global error caught:', event.error || event.message);
    
    if (window.errorManager) {
      window.errorManager.logError(event.error || new Error(event.message), 'GlobalError', {
        metadata: {
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno
        },
        showToast: true
      });
    }
  });

  window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    
    if (window.errorManager) {
      window.errorManager.logError(event.reason, 'UnhandledPromise', { showToast: true });
    }
    
    // Prevent browser console error
    event.preventDefault();
  });

  // Performance monitoring
  window.addEventListener('load', function() {
    if (window.performance && window.performance.timing) {
      const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
      console.log(`Page load time: ${loadTime}ms`);
      
      if (loadTime > 3000 && window.errorManager) {
        window.errorManager.logError(
          new Error(`Slow page load: ${loadTime}ms`), 
          'Performance', 
          { metadata: { loadTime, threshold: 3000 } }
        );
      }
    }
  });
</script>
